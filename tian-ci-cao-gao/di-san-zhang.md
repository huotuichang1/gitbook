---
description: 声源定位追踪
---

# 第三章

　　为了提高声源定位的鲁棒性，我们必须对声源位置进行追踪，为之后对时延，方位信息强依赖的波束形成过程提供保证，我们引入一些方法对声源位置进行追踪。比如说卡尔曼滤波，粒子滤波等。

## 1.卡尔曼滤波器进行声源位置追踪

　　定位跟踪时，可以通过某种定位技术得到一个位置估计（观测位置），也可以根据我们的经验（运动目标常常是匀速运动的）由上一时刻的位置和速度来预测出当前位置（预测位置）。把这个观测结果和预测结果做一个加权平均作为定位结果，权值的大小取决于观测位置和预测位置的不确定性程度，在数学上可以证明在预测过程和观测过程都是线性高斯时，按照卡尔曼的方法做加权是最优的。

　　然而在有些应用中，如果不是线性高斯的情况该怎么办？可以采用EKF（扩展卡尔曼滤波），在工作点附近对系统进行线性化，即使不是高斯也近似成高斯去做。这样做有点太粗糙了，于是又有了IEKF（迭代卡尔曼滤波，对工作点进行迭代优化），UKF或SPKF（无迹卡尔曼滤波，不做线性化，而是投影做出一个高斯分布去近似）。或者抛弃各种假设，直接采用蒙特卡洛的方式，假设出很多的粒子去近似分布，就是PF（粒子滤波）。（其实粒子滤波的内核思想和卡尔曼滤波是类似的，但为了更广阔的适用性其抛弃了线性高斯前提，用大量粒子进行模拟近似分布）

　　这里先使用卡尔曼滤波进行说明。在进行说明之前，我们应当了解到卡尔曼滤波可以被用于什么场景下。你可以在任何含有不确定信息的动态系统中使用卡尔曼滤波，对系统下一步的走向做出，即使有根据的预测伴随着各种干扰，卡尔曼滤波总是能指出真实发生的情况。举个例子，假设我养了一只猪：

　　一周前，这只猪的体重是46±0.5kg。注意，在这里我用了±0.5，表示其实我对这只猪一周前的体重并不是那么确定的，也就是说，46kg这个体重有0.5kg的误差。现在，我又养了这只猪一个星期。那么我想要知道它一个星期之后多重，又大概有多少的误差？

　　为了得到一周后的体重，我有两种方法：一是根据我多年的养猪经验得到的猪体重公式推求出一个大概的值，另一个就是直接去称它的体重。当然，两种方法都有一定的误差。假设经验公式得到的体重是48kg，误差2kg；直接称体重得到的是49kg，误差1kg：

　　可是，不管是经验公式得到的值，还是直接称量得到的值，我都觉得不够准。我希望有一种方法，可以同时结合这只猪一周前的体重、用经验公式估计的值以及直接称量得到的值，综合考虑，得出一个最接近猪真实体重的，误差最小的值。这就是卡尔曼滤波要完成的任务。现在我们来把养猪的模型抽象成数学公式：

![](../.gitbook/assets/kalman-to-pig.png)

　　上图的左边，上一周的猪的体重，可以抽象为 $$k-1$$ 时刻的状态值，用 $$k-1$$ 时刻的最优估计值加上一个误差项来表示，右边同理。其中： $$P_k=E[e_ke_k^T]$$ 表示的是估计值的协方差。图中右边表示k时刻的状态值，这个值通过预测模块（也就是根据经验公式估计猪的体重）和纠错模块（也就是直接去称量猪的体重值）来估计。同样，预测模块和纠错模块都有着对应的误差和误差协方差矩阵。卡尔曼滤波要做的，就是根据贝叶斯估计的相关理论，同时考虑预测模块和纠错模块的协方差，对误差小的项赋予较大的权重，对误差大的项赋予较小的权重，并使预测的误差最小。 　　  
　　在连续变化的系统中使用卡尔曼滤波是非常理想的做法，它具有占用内存小的优点（除了前一个状态量外，不需要保留其它历史数据），并且速度很快，很适合应用于实时问题和嵌入式系统。

　　卡尔曼追踪原理基本思想是两个过程，一个预测过程，一个更新过程（纠错模块）。

![](../.gitbook/assets/kalman-introduction.png)

　　这次我们描述一个较复杂的问题，三维声源位置信息的追踪。在时间 $$k$$ ，声源位置为 $$x_k$$。我们给定一个向量 $$\hat {x_k} = (\vec {p}, \vec {v})$$ 。其中一个为位置，一个为速度。由于是三维位置速度信息， $$\hat {x_k} $$ 是一个长度为六的向量。前三项是位置，后三项是速度。对位置的更新如下：

$$
\hat{x}_k=\left[\begin{matrix}1\quad0\quad0\quad\Delta t\quad0\quad0\\0\quad1\quad0\quad0\quad\Delta t\quad0\\0\quad0\quad1\quad0\quad0\quad\Delta t\\0\quad0\quad0\quad1\quad0\quad0\\0\quad0\quad0\quad0\quad1\quad0\\0\quad0\quad0\quad0\quad0\quad1\end{matrix}\right]*\hat{x}_{k-1}=F_k\hat{x}_{k-1}
$$

　　这个代表的是声源位置的经验预测值。相对应的，这个状态对应的协方差应该表现如下:

$$
P_k=F_kP_{k-1}F_k^T
$$

　　然后考虑到除了系统自身状态的影响，还有可能存在外在因素对系统进行控制。在我们的声源定位模型中，没有已知的外部控制量控制，即使有变化也是未知的。因此我们只能让这部分被认为是系统自身的变化。除此之外，协方差上也会存在未知的干扰，我们将这些没有被追踪到的干扰当做协方差为 $$Q_k$$ 的噪声来处理，其均值为零。这样就得到了当前状态的预测值 $$\hat{x}_k$$ 和协方差矩阵 $$P_k$$ ，表达式如下：

$$
\hat{x}_k=F_k\hat{x}_{k-1}\\P_k=F_kP_{k-1}F_k^T＋Q_k
$$

　　结合起来，我们就得到了卡尔曼滤波器的预测过程。从这里可以看到，新的最优位置估计是由上一最优位置估计得到的，新的不确定性由上一不确定性（协方差）预测得到，并且加上外部环境的干扰。

　　接下来是卡尔曼滤波器的更新过程。我们要想到的是，仅仅预测是不够准确的，放在我们的模型中，就是用当前时刻的声源定位位置信息对用上一最优位置估计出这一时刻的预测值进行修正。

　　在定位中，我们必须考虑到的是我们的声源定位得到的位置信息的数据单位和尺度和我们跟踪的状态变量可能不一致。我们使用 $$H_k$$ 来修正这一不一致。考虑到卡尔曼滤波是基于高斯分布假设，这样可以得到其表述过程如下\(这里的是预测值转化为高斯分布的均值/方差的过程\)：

$$
\overrightarrow{\mu}_{expected}=H_k\hat{x}_k
\\\sum_{}._{expected}=H_kP_kH_k^T
$$

　　再来考虑观测值，由于声源定位过程中的不可避免地会出现很多误差，我们将总的不确定性用协方差 $$R_k$$ 表示，然后观测值状态变量的均值就是我们读取到的声源定位数据。状态不同，协方差亦不同。这个状态分布的均值就是我们声源定位过程中得到的定位数据 $$z_k$$ \(这个相当于是刚刚养猪例子中用体重秤量得的数据\)。

　　此时我们有了两个描述当前时刻声源位置状态的量。化为高斯分布，一个是预测值均值 $$\vec{\mu}_{expected}=H_k\hat{x}_k$$ ，方差为 $$\sum_{}._{expected}=H_kP_kH_k^T$$ 。一个是测量值均值 $$\vec{z_k}$$ ，方差为 $$R_k$$ 。这是两个高斯分布。

　　然后我们如何通过这两个高斯分布状态量得到最优估计呢？当前状态的最优估计是重叠部分的均值，也就是给定已知的所有信息中的最优估计。把两个具有不同均值和方差的高斯分布相乘，我们得到一个新的具有独立均值和方差的高斯分布，这是高斯分布的融合性。高斯分布的融合后的结果就是我们想要的值。

