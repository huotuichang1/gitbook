---
description: 'DOA,麦克风阵列声源定位。一切的开始，准确最关键。'
---

# 第二章

　　麦克风阵列技术的开始就是声源定位技术，只有通过声源定位得到声波到达时延信息或者说其中蕴涵的位置/方位信息才能将多个麦克风的数据通过波束形成技术有效地整合在一起而后进行后续的处理。因此麦克风阵列的定位准确度对麦克风阵列的效果有极大地影响。麦克风阵列声源定位技术大体可分为三类：一、基于波束形成的方法；二、基于子空间的方法；三、基于时延估计的定位方法。下面介绍各类定位技术的基本原理。然后对odas进行解析。

## 1.基于可控波束形成的声源定位技术

　　波束形成是阵列处理中一类重要技术,它通过加强特定方向传播信号的能量来修正阵列波束方向。单组阵列波束形成器通过搜索整个空间来确定能量最大的波束,从而估计出声源波达方向,而两组阵列的传播方向相交,就可以估计出声源位置。基于可控波束形成的定位算法,主要有延迟求和波束形成和自适应滤波求和波束形成方法。\(而实际上由于波传播过程中误差的存在，可能存在阵列搜索出的方向不存在交点的情况，此时若想得到声源的位置而不只是方位信息，最好的方法是多个阵列进行定位，锁定声源可能的区域。\)

### 1.1.延时求和波束形成声源定位

　　我们设麦克风数目为 $$M$$ ,第 $$m$$ 个麦克风接收信号为 $$x_m(n)$$ ，信号到达麦克风的时延为 $$\tau_m$$ ，各路麦克风接受信号的增益相同，干扰噪声在统计上相互独立，那么我们可以对语音信号 $$s(n)$$ 进行如下的合理估计：

$$
s(n)=\frac{1}{M}\sum_{m=1}^Mx_m(n+\tau_m)
$$

　　这即是最简单的延时求和波束形成器,又称固定波束形成器。它仅仅根据时间延迟对阵列信号进行时间校正,以补偿语音信号由声源到达不同麦克风所产生的延时,延时一求和波束形成器如图所示。

![](../.gitbook/assets/20180818-101415-de-ping-mu-jie-tu.png)

　　自然而然，我们想到在时域上的运算过于繁琐，可以将该延时求和波束形成器转换成频域形式进行处理计算。设声源到阵列的辐射角为 $$\theta$$ ，则方向矢量 $$\vec A(k,\theta)=[1,e^{j2\pi k\tau_1(\theta)},e^{j2\pi k\tau_2(\theta)},...,e^{j2\pi k\tau_M(\theta)}]$$ 。延时求和波束形成器的输出 $$ y(n)$$ 的频率描述 $$Y(k)$$ 为：

$$
Y(k)=\frac{1}{M}\sum_{m=1}^{M}X_m(k)W_m(k)=\vec X(k) \vec W(k)
$$

　　即为 $$X_m(k)$$在频域上的移项相加。 $$\vec X(k)$$ 是麦克风接收信号的频域形式， $$\vec W(k)$$ 是方向矢量，有等式 $$\vec  W(k)=\vec A(k,\theta)$$ 。基于延时-求和波束形成的声源定位方法是根据波束最大输出能量确定声源位置，即： $$\theta=arg max_\theta \sum_k \vec A^H(k,\theta) \vec R_{XX}(k) \vec A(k,\theta)$$ ，其中 $$ \vec R_{XX}(k)=E{\vec X(k) \vec X^T(k)}$$ 。需要注意到我们此时得到的只是声源的方向信息，并没有得到声源的距离。

### 1.2.滤波求和波束形成

　　 延时求和波束形成器实际上是一种滤波器系数恒定的固定波束形成器，在实际应用中，为适应噪声情况，更常使用滤波求和波束形成器。滤波求和波束形成器通过自适应地调整滤波器系数，使得波束主瓣对准来波方向,同时使得零陷\(NULL\)对准干扰方向。设阵列中每个滤波器阶数均为 $$L$$ ​,第​ $$m$$ 个滤波器的冲激响应为 $$h_{m,l}$$ ​，于是滤波求和波束形成器的时域描述为:

$$
y(n)=\sum^M_{m=1} \sum^{L-1}_{l=0} h_{m,l}x_m(n-l)
$$

　　输出信号 $$y(n)$$ 的频域描述 $$Y(k)$$ 为

$$
Y(k)=\sum_{m=1}^M H^*_m(k)X_m(k)=\vec H^H(k)\vec X(k), \quad k=1,......,K
$$

　　其中，​ $$X_M(k)$$ 和​ $$H_M(k)$$ 分别为​ $$x_m(n)$$ 和​ $$h_{m,l}$$ 的离散傅里叶变换。

$$
\vec X(k)=(X_1(k),......,X_M(k))^T\quad\quad\quad\quad\vec H(k)=(H_1(k),...,H_M(k))^T
$$

　　波束形成器的信噪比定义为

$$
SNR(k)=\frac{\vec H^H(k) \vec R_{XX}(k) \vec H(k)}{\vec H^H(k) \vec R_{NN}(k)\vec H(k)}-1
$$

　　基于信噪比最大准则，加权系数 $$H(k)$$ ​的计算等价于求解如下约束优化问题

$$
\left \{ 
\begin{array}{c}
max \quad \vec H^H(k)\vec R_{XX}(k)\vec H(k)\\

\quad s.t. \quad \vec H^H(k)\vec R_{NN}(k)\vec H(k)=C

\end{array}
\right.
$$

　　滤波求和波束形成器的声源定位原理图如图所示。滤波求和波束形成器在进行时间校正的同时，还对信号进行滤波处理。

$$
Y(k)=\sum^M_{m=1}H_m(k)X_m(k)e^{j2\pi k\tau_m}
$$

　　其中 $$H_m(k)$$ 为第 $$m$$ 个麦克风接收信号的滤波器。 $$e^{j2\pi k\tau_m}$$ 是时延补偿量，保证频域信号的时间一致性。 $$Y(k)$$ 是某个频域上的信号幅度。

![&#x6EE4;&#x6CE2;&#x6C42;&#x548C;&#x6CE2;&#x675F;&#x5F62;&#x6210;&#x5668;&#x6846;&#x56FE;](../.gitbook/assets/lv-bo-qiu-he-bo-shu-xing-cheng-qi-ding-wei.png)

　　基于滤波求和波束形成器的声源定位方法可描述为：

$$
r_m(\vec q,k)=\sum^M_{m=1}H_m(k)|X_m(k)|e^{-j2\pi k\tau_m(q)}\\|r_m(q)|^2=\sum_k H(k)|r_m(\vec q,k)|^2\\
\hat q=arg max_m|r_m(\vec q)|^2
$$

　　其中​ $$X_m(k)$$ 是k频率下第m个麦克风的信号幅度。而滤波求和波束形成器的波束响应 $$H(k,\theta) $$ 为

$$
H(k,\theta)=\sum_{m=1}^M \sum_{l=1}^Lh_{m,l}e^{-j2\pi(l-1)T}e^{-j2\pi kd_m sin\theta /c}
$$

　　该滤波求和波束形成器在保持非目标方向功率不变的情况下，使目标方向的功率最大，同理，也可以保持在目标方向上的信号功率不变，而使非目标方向上的干扰功率最小。即

$$
\left \{ 
\begin{array}{c}
min \quad \vec H^H(k)\vec R_{XX}(k)\vec H(k)\\

\quad s.t. \quad \vec A^H(k,\theta)\vec H(k)=1

\end{array}
\right.
$$

　　其权值为：

$$
H(k)=\frac{\vec R^{-1}_{xx}\vec A(k,\theta)}{\vec A^H(k,\theta)\vec R_{xx}^{-1}(k)\vec A(k,\theta)}
$$

　　相关矩阵在这里可以被利用于构造 $$P(k,\theta)$$ 。

$$
P(k,\theta)=\frac{1}{A^H(k,\theta)R_{xx}^{-1}(k)A(k,\theta)}
$$

　　空间谱 $$P(\theta)$$ 为 $$p(\theta)=\sum_{k=1}^KP(k,\theta)$$ 。

　　通过寻找空间谱 $$P$$ 的峰值，就可以估计声源的方向。

## 2.基于子空间方法的声源定位技术

        基于子空间技术的声源定位算法来源于高分辨率谱估计，下面从信号模型开始介绍。（我们并没有使用这个方法，放在这里只是介绍说明）

        在由 $$M$$ 个麦克风组成的均匀线性阵列阵中，假设噪声为高斯白噪声，且各麦克风之间的噪声不相关，信号与噪声也相互独立，空间中有 $$P$$ 个声源，第 $$i$$ 个声源信号为 $$s_i(n)$$ ，第 $$i$$ 个声源至第 $$m$$ 个麦克风的传播时延为 $$\tau_{mi}$$ ，加性噪声为 $$b_m(n)$$ 。第 $$m$$ 个麦克风接受到的语音信号 $$x_m(n)$$ 可表示为

$$
x_m(n)=\sum_{i=1}^Ps_i(n-\tau_{mi})+b_m(n)
$$

        将信号数据 $$x_m(n)$$ 分成 $$K$$ 个子段\( $$K$$ 为快拍数\)。在每个子段中，可以认为语音信号为平稳信号， $$x_m(t),s_p(t),n_m(t)$$ 的离散傅里叶变换分别为 $$X_m(f_j),S_p(f_j),N_m(f_j)$$ 。由此我们得到：

$$
X(f_j)=A_{\theta}(f_j)S(f_j)+N(f_j),\quad j=1,...,J\\
X(f_j)=[X_1(f_j)X_2(f_j)...X_M(f_j)]^T\\
N(f_j)=[N_1(f_j)N_2(f_j)...N_M(f_j)]^T\\
S(f_j)=[S_1(f_j)S_2(f_j)...S_M(f_j)]^T\\
$$

        噪声协方差矩阵 $$R_N(f_j)=E\{N(f_j)N^H(f_j)\}=\sigma^2_nI_M$$。方向矩阵 $$A_{\theta}(f_j)$$ 由 $$P$$ 个方向向量 $$a_{\theta,p}$$ 组成，即   

$$
a_{\theta,p}=[1,e^{-j2\pi f_j\tau_1},...,e^{-j2\pi f_j\tau_{M-1}}]^T,\quad p=1,...,P\\
A_{\theta}(f_j)=[a_{\theta,1},a_{\theta,2},...,a_{\theta,p}]
$$

        在频率 $$f_j$$ 处，麦克风阵列接受信号在频域的协方差矩阵为：

$$
R_x(f_j)=A_{\theta}(f_j)R_s(f_j)A_{\theta}^H(f_j)+R_N(f_j)
$$

        其中， $$R_S(f_j)$$ 为频率 $$f_j$$ 处的窄带信号的协方差矩阵， $$R_N(f_j)$$ 为窄带噪声的协方差矩阵。 $$R_X(f_j)$$ 的信号子空间 $$U_S(f_j)$$ 与噪声子空间 $$U_N(f_j)$$ 正交，且信号子空间 $$U_S(f_j)$$ 与 $$A_{\theta}(f_j)$$ 处于同一空间。子空间算法就是利用麦克风接收数据，对方向向量 $$A_{\theta}$$ 中的方向参数 $$\theta$$ 进行估计。

        子空间算法可以从子空间拟合的角度来说明，下面介绍子空间拟合的理论框架以及各类子空间算法。子空间拟合问题可以描述为：给定矩阵 $$M$$ ，选择固定矩阵 $$\hat A$$ 和测度 $$\hat T$$ 使得 $$\hat A$$ 的值域空间尽可能的接近 $$M$$ 的值域空间。然后看如下子空间拟合准则。其中F表示Frobenius范数。

$$
\hat A,\hat T=argmin_{A,T}||M-\hat AT||^2_F
$$

        子空间拟合问题中 $$A$$ 和 $$T$$ 一般是可分离的。如信号和传播信道是可分离的，则 $$T$$的最小二乘解为       

$$
\hat T=(A^HA)^{-1}A^H=A^{-1}M
$$

        综合起来，可以得到子空间拟合的等价问题：

$$
\hat A=argmax_A trace(P_AMM^H)
$$

        其中 $$P_AM=\hat A A^{-1}M$$是 $$M$$ 到 $$A$$ 的列空间的投影，选择不同的已知矩阵 $$M$$，可以得到不同的子空间方法：

\(1\)极大似然法

        设数据协方差矩阵的Hermitian平方根为 $$R^{1/2}$$ ，设 $$M = R^{1/2}$$ 带入问题式中。则可以得到极大似然准则

$$
\hat \theta=argmax_{\theta}trace(P_A(\theta)R)
$$

        由此可见，极大似然法实际上是对数据矩阵拟合由 $$A_{\theta}$$ 的列张成的子空间。

\(2\)多维MUSIC方法

        设信号特征向量矩阵为 $$U_S$$ ，将 $$M=U_s$$ 代入问题式中，多维MUSIC方法准则可以表示为

$$
\hat \theta=argmax_{\theta}trace(P_AU_SU_S^H)
$$

        可以看出来，多维MUSIC方法是用数据的信号子空间拟合由 $$A_{\theta}$$的列张成的子空间。

\(3\)ESPRIT方法

        方向向量矩阵 $$A$$可分解为一个子空间 $$\Gamma$$ 和该子空间的旋转 $$\Gamma_{\phi}$$ ，即 $$A=[\Gamma \quad \Gamma_{\phi}]^T$$ 其中 $$\phi$$ 是旋转因子。对应于方向向量矩阵 $$A$$ 的旋转子矩阵分解，信号子空间 $$U_S$$ 可分解为 $$[U_1\quad U_2]^T$$，当特征向量无扰动时， $$U_S$$和 $$A$$对应于同一空间，即

$$
\left ( \begin{aligned}U_1 \\ U_2\end{aligned}\right )=\left ( \begin{aligned}\Gamma \ \\ \Gamma_\phi \end{aligned}\right )T
$$

        其中 $$T$$为测度。于是信号子空间对应的旋转关系为

$$
U_2=U_1T^{-1}\phi T=U_1\psi
$$

        令 $$M=Us$$，将旋转关系代入问题式中，得到ESPRIT方法准则

$$
\hat \theta=argmax_{A=[\Gamma\quad \Gamma_\phi]^T}trace(P_AU_SU_S^H)
$$

        由此可见，ESPRIT方法是对信号空间的两个旋转子空间和 $$A_\theta$$的列张成的两个旋转子空间进行拟合。

## 3.基于时延估计的声源定位方法

        这类声源定位方法是估计不同麦克风传感器间的波达时延。考虑混响信号模型，依据听觉环境的不同，可以分成两种情况考虑波达方向估计中的信号模型：1，自由场模型，即环境中不存在对声音信号的反射。我们只需要考虑信号经由直接路径到达麦克风传感器的情形。2，混响环境模型，即环境中存在对声音信号的反射。除了考虑信号经由直接路径到达麦克风传感器外，还需要考虑信号经由许多反射路径到达麦克风传感器的情形。

        进一步可以在这两种模型基础上分为单声源和多声源的情况进行考虑，但本文主要的处理对象是单声源模型。

        根据上面的分类，我们可以建立两种关于单个声源的信号模型：

1.单声源自由场信号模型

        假设环境中只有一个声源与一个具有 $$N$$个麦克风传感器的麦克风阵列，在四周无反射的环境中，语音信号源像四周辐射传播，信号强度随着传播距离的增加而减小。设某一麦克风传感器1为参考传感器，则第 $$n$$个麦克的传感器在时刻 $$k$$接收到的信号可以表示为：

$$
y_n(k)=\alpha_ns(k-t-\tau_{n1})+v_n(k)\\ \alpha_ns[k-t-F_n(\tau)]+v_n(k)\\
=x_n(k)+v_n(k),n=1,2,...,N
$$

        其中， $$\alpha_n(n=1,2,...,N)$$取值范围为 $$0 ～1$$之间，是声音传播过程中的衰减因子， $$s(k)$$为未知声源， $$t$$是信号从信号源到达参考传感器的传播时间， $$v_n(k)$$是第 $$n$$个麦克风传感器接收到的加性噪声信号，并假设为与目标语音信号及其它噪声信号均不相关。 $$\tau$$为麦克风1和麦克风2之间的波达时延， $$\tau_{n1}=F_n(\tau)$$是第一个麦克风传感器与第 $$n$$个麦克风传感器之间的波达时延，并且有 $$F_1(\tau)=0,F_2(\tau)=\tau$$。对于 $$n=3,...,N$$，函数 $$F_n$$不仅取决于 $$\tau$$ ，还取决于麦克风阵列的拓扑结构。均匀线性阵列如下：

$$
F_n(\tau)=(n-1)\tau,\quad n=2,3,...,N
$$

        而对于非均匀线性麦克风阵列，则有

$$
F_n(\tau)=\frac{\sum_{t=1}^{n-1}d_i}{d_1}\tau,\quad n=2,...,N
$$

        其中， $$d_i$$为第 $$i$$和 $$a = b$$麦克风传感器的距离 $$(i=1,...,N-1)$$ 。在近场的条件下， $$F_n$$还将取决于声源的位置。但我们大部分考虑远场情况，所以了解就好。同时由于大部分情况麦克风阵列的几何拓扑结构已知，因此 $$F_n(\tau)$$的数学形式也是已知的。所以时延估计的问题，就是通过观察到的采样信号来获得真实时延 $$\tau$$的估计。

        但考虑到真实的环境下有混响的影响，我们需要建立更合理，真实的模型来模拟多径传播的影响。我们将路径传播冲激响应视作FIR滤波器。这样第 $$n$$个麦克风传感器接收到的信号为：

$$
y_n(k)=g_n*s(k)+v_n(k)=x_n(k)+v_n(k),\quad n=1,2,...,N
$$

        其中 $$g_n$$ 是从声源到麦克风传感器 $$n$$的信道冲激响应。用矩阵的形式写上式： $$\vec y_n(k)=\vec G_n\vec s(k)+\vec v_n(k),\quad n=1,2,...,N$$ 

$$
\vec y_n(k)=[y_n(k)...y_n(k-L+1)]^T,\\
\vec G_n=\left (\begin{aligned} g_{n,0}...g_{n,L-1}...0\\...\quad ...\quad ...\quad ...\\
0...g_{n,0}...g_{n,L-1} \end{aligned}\right )\\
\vec s(k)=[s(k)s(k-1)...s(k-L+1)...s(k-2L+2)]^T\\
\vec v_n(k)=[v_n(k)...v_n(k-L+1)]^T
$$

        此处出现的 $$L$$是SIMO系统的信道冲击响应的最大长度，这里同样假设 $$v_n(k)$$与信号源和其他麦克风传感器的噪声不相关。而混响模型与自由场模型相比，波达时延 $$\tau$$的估计增加了一定的难度，因为这种情况下源信号实际是未知的，需要进行识别。而我们估计而言最常用的方法就是广义互相关法 $$(GCC)$$这种方法是通过获取使接收到的信号的互相关函数最大的时间差来估计时延。这种方法最大的弊端是会受到混响的严重影响。下面用一个简单例子来分析。设 $$y_i$$是第 $$i$$个麦克风传感器接收到的信号，则单声源自由场信号模型可以写为：

$$
y_i(n)=\alpha_is(n-\tau_i)+v_i(n),\quad i=1,2
$$

        

